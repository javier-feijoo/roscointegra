<!doctype html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RoscoIntegra</title>
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>
  <svg class="icon-sprite" aria-hidden="true">
    <symbol id="i-play" viewBox="0 0 24 24"><path fill="currentColor" d="M8 5v14l11-7z"/></symbol>
    <symbol id="i-pause" viewBox="0 0 24 24"><path fill="currentColor" d="M7 5h4v14H7zm6 0h4v14h-4z"/></symbol>
    <symbol id="i-stop" viewBox="0 0 24 24"><path fill="currentColor" d="M6 6h12v12H6z"/></symbol>
    <symbol id="i-reset" viewBox="0 0 24 24"><path fill="currentColor" d="M12 5a7 7 0 1 1-6.3 4H3l3.5-3.5L10 9H7.8A5 5 0 1 0 12 7V5z"/></symbol>
    <symbol id="i-full" viewBox="0 0 24 24"><path fill="currentColor" d="M4 9V4h5v2H6v3H4zm14 0V6h-3V4h5v5h-2zM6 15v3h3v2H4v-5h2zm12 0h2v5h-5v-2h3v-3z"/></symbol>
    <symbol id="i-plus" viewBox="0 0 24 24"><path fill="currentColor" d="M11 5h2v6h6v2h-6v6h-2v-6H5v-2h6z"/></symbol>
    <symbol id="i-exit" viewBox="0 0 24 24"><path fill="currentColor" d="M10 17l1.4-1.4L9.8 14H20v-2H9.8l1.6-1.6L10 9l-4 4l4 4zM4 5h8V3H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h8v-2H4V5z"/></symbol>
    <symbol id="i-eye" viewBox="0 0 24 24"><path fill="currentColor" d="M12 5c-5.2 0-9.4 3.2-11 7c1.6 3.8 5.8 7 11 7s9.4-3.2 11-7c-1.6-3.8-5.8-7-11-7zm0 11a4 4 0 1 1 0-8a4 4 0 0 1 0 8z"/></symbol>
    <symbol id="i-pass" viewBox="0 0 24 24"><path fill="currentColor" d="M5 5h2v14H5zm4 7l10-7v14z"/></symbol>
    <symbol id="i-check" viewBox="0 0 24 24"><path fill="currentColor" d="m9 16.2l-3.5-3.5L4 14.2l5 5l11-11l-1.5-1.5z"/></symbol>
    <symbol id="i-x" viewBox="0 0 24 24"><path fill="currentColor" d="m19 6.4l-1.4-1.4L12 10.6L6.4 5L5 6.4L10.6 12L5 17.6L6.4 19l5.6-5.6l5.6 5.6l1.4-1.4L13.4 12z"/></symbol>
    <symbol id="i-sound" viewBox="0 0 24 24"><path fill="currentColor" d="M3 10v4h4l5 4V6L7 10H3zm12.5 2a3.5 3.5 0 0 0-2-3.1v6.2a3.5 3.5 0 0 0 2-3.1z"/></symbol>
  </svg>
  <main id="appRoot" class="app-root">
    <section id="viewLanding" class="view landing-view">
      <div class="landing-card">
        <div class="lang-selector">
          <label for="lang-select" data-i18n="languageLabel">Idioma:</label>
          <select id="lang-select">
            <option value="es" data-i18n="languageSpanish">Español</option>
            <option value="gl" data-i18n="languageGalician">Galego</option>
            <option value="en" data-i18n="languageEnglish">English</option>
          </select>
        </div>
        <img class="landing-logo" src="assets/img/logo.png" alt="Logo RoscoIntegra" />
        <p class="subtitle" data-i18n="author">Autor: Javier Feijóo</p>
        <div class="actions-stack">
          <button id="btnGoConfig" class="btn btn-primary btn-xl" data-i18n="configureGame">Configurar partida</button>
          <button id="btnLandingStart" class="btn btn-xl" disabled data-i18n="startGame">Iniciar partida</button>
        </div>
        <div class="status-box compact">
          <label for="playerNameInput" data-i18n="playerLabel">Persona o equipo</label>
          <input
            id="playerNameInput"
            type="text"
            maxlength="40"
            data-i18n-placeholder="playerPlaceholder"
            placeholder="Escribe nombre de persona o equipo"
          />
          <p><strong data-i18n="currentPlayer">Persona/equipo actual:</strong> <span id="currentPlayerName">-</span></p>
        </div>
        <p id="landingStartHint" class="hint"></p>
        <div class="status-box">
          <p><strong data-i18n="currentBank">Banco actual:</strong> <span id="landingBankOrigin">-</span></p>
          <p><strong data-i18n="file">Archivo:</strong> <span id="landingBankFile">-</span></p>
          <p><strong data-i18n="questions">Preguntas:</strong> <span id="landingBankCount">0</span></p>
        </div>
        <div class="status-box">
          <button id="btnViewTopScores" class="btn" data-i18n="viewTop10">Ver Top 10</button>
        </div>
      </div>
    </section>

    <section id="viewConfig" class="view config-view hidden">
      <header class="section-header">
        <h2 data-i18n="configureGame">Configurar partida</h2>
        <div class="actions-inline">
          <button id="btnBackToLanding" class="btn" data-i18n="backToStart">Volver a inicio</button>
        </div>
      </header>

      <div class="config-grid">
        <aside class="panel">
          <h3 data-i18n="questionBankTitle">Banco de preguntas</h3>

          <label for="assetBankSelect" data-i18n="assetBankLabel">Banco en /assets</label>
          <select id="assetBankSelect">
            <option value="">Cargando bancos...</option>
          </select>
          <button id="btnLoadAssetBank" class="btn" data-i18n="loadBank">Cargar banco</button>

          <label for="jsonInput" data-i18n="pasteJsonLabel">Pegar JSON</label>
          <textarea id="jsonInput" rows="8" data-i18n-placeholder="jsonPlaceholder" placeholder='Pega aqui tu JSON con "preguntas"'></textarea>
          <button id="btnLoadJson" class="btn" data-i18n="validateLoadPasted">Validar y cargar pegado</button>

          <label for="jsonFile" data-i18n="importJsonLabel">Importar archivo .json</label>
          <input id="jsonFile" type="file" accept="application/json,.json" />

          <div class="status-box compact">
            <p><strong data-i18n="originLabel">Origen:</strong> <span id="loadSource">-</span></p>
            <p><strong data-i18n="file">Archivo:</strong> <span id="loadFile">-</span></p>
            <p><strong data-i18n="totalLabel">Total:</strong> <span id="loadTotal">0</span></p>
            <p><strong data-i18n="duplicatesLabel">Duplicadas:</strong> <span id="loadDuplicates">No</span></p>
            <p><strong data-i18n="missingLabel">Ausentes:</strong> <span id="loadMissing">-</span></p>
          </div>

          <p id="loadStatus" class="status-text" data-i18n="loadBankToPlay">Carga un banco para habilitar el juego.</p>
        </aside>

        <aside class="panel">
          <h3 data-i18n="parametersTitle">Parametros</h3>

          <div class="two-cols">
            <div>
              <label for="cfgTime" data-i18n="totalTimeLabel">Tiempo total</label>
              <input id="cfgTime" type="number" min="1" step="1" value="180" />
            </div>
            <div>
              <label for="cfgTimeUnit" data-i18n="unitLabel">Unidad</label>
              <select id="cfgTimeUnit">
                <option value="seconds" data-i18n="seconds">Segundos</option>
                <option value="minutes" data-i18n="minutes">Minutos</option>
              </select>
            </div>
          </div>

          <div class="two-cols">
            <div>
              <label for="cfgPoints" data-i18n="pointsPerHit">Puntos por acierto</label>
              <input id="cfgPoints" type="number" min="0" value="10" />
            </div>
            <div>
              <label for="cfgPenalty" data-i18n="penaltyWrong">Penalizacion por fallo</label>
              <input id="cfgPenalty" type="number" min="0" value="0" />
            </div>
          </div>

          <label class="inline-control" for="cfgShuffle">
            <input id="cfgShuffle" type="checkbox" checked />
            <span data-i18n="shuffleByLetter">Shuffle por letra</span>
          </label>

          <label class="inline-control" for="cfgAudioEnabled">
            <input id="cfgAudioEnabled" type="checkbox" checked />
            <span data-i18n="audioEnabledLabel">Audio habilitado (TTS/fallback local)</span>
          </label>

          <div class="three-cols">
            <div>
              <label for="filterCycle" data-i18n="cycleLabel">Ciclo</label>
              <select id="filterCycle"><option value="">Todos</option></select>
            </div>
            <div>
              <label for="filterModule" data-i18n="moduleLabel">Modulo</label>
              <select id="filterModule"><option value="">Todos</option></select>
            </div>
            <div>
              <label for="filterDifficulty" data-i18n="difficultyLabel">Dificultad</label>
              <select id="filterDifficulty"><option value="">Todos</option></select>
            </div>
          </div>

          <h3>TTS</h3>
          <p id="ttsStatus" class="status-text" data-i18n="checkingTts">Comprobando TTS...</p>
          <label for="ttsVoice" data-i18n="voiceLabel">Voz</label>
          <select id="ttsVoice"><option value="">Preferida (espanol)</option></select>
          <div class="two-cols">
            <div>
              <label for="ttsRate">Rate</label>
              <input id="ttsRate" type="number" step="0.1" min="0.5" max="2" value="1" />
            </div>
            <div>
              <label for="ttsPitch">Pitch</label>
              <input id="ttsPitch" type="number" step="0.1" min="0" max="2" value="1" />
            </div>
          </div>

          <label class="inline-control" for="cfgTeacherMode">
            <input id="cfgTeacherMode" type="checkbox" />
            <span data-i18n="teacherMode">Modo docente (depuracion)</span>
          </label>

          <div class="actions-stack">
            <button id="btnSaveConfig" class="btn" data-i18n="saveConfig">Guardar configuracion</button>
            <button id="btnStartFromConfig" class="btn btn-primary" data-i18n="startGame">Empezar partida</button>
            <button id="btnResetConfig" class="btn" data-i18n="resetConfig">Restablecer configuracion</button>
            <button id="btnClearTopScores" class="btn" data-i18n="clearTop10">Borrar Top 10</button>
          </div>
          <p id="configStatus" class="status-text"></p>
        </aside>

        <aside class="panel">
          <h3 data-i18n="loadDiagnostic">Diagnostico de carga</h3>
          <p class="status-text" data-i18n="fileProtocolWarn">Si abres la app con file:// algunos navegadores bloquean fetch a /assets.</p>
          <pre id="diagnosticLog" class="diagnostic-log"></pre>
        </aside>
      </div>
    </section>

    <section id="viewGame" class="view game-view hidden">
      <div id="gameContainer" class="game-container">
        <header class="game-header">
          <div class="hud-box hud-left">
            <span data-i18n="timerLabel">Temporizador</span>
            <strong id="timerDisplay">00:00</strong>
          </div>
          <div class="game-top-actions">
            <button id="btnTimerPause" class="btn btn-top btn-tone-time" data-i18n-title="pauseTime"><svg class="icon"><use href="#i-pause"/></svg><span data-i18n="pause">Pausar</span></button>
            <button id="btnTimerResume" class="btn btn-top btn-tone-time" data-i18n-title="resumeTime"><svg class="icon"><use href="#i-play"/></svg><span data-i18n="resume">Reanudar</span></button>
            <button id="btnTimerReset" class="btn btn-top btn-tone-time" data-i18n-title="resetTime"><svg class="icon"><use href="#i-reset"/></svg><span data-i18n="reset">Reiniciar</span></button>
            <button id="btnFullscreen" class="btn btn-top btn-tone-view" data-i18n-title="fullscreen"><svg class="icon"><use href="#i-full"/></svg><span data-i18n="screen">Pantalla</span></button>
            <button id="btnNewGame" class="btn btn-top btn-tone-game" data-i18n-title="newGame"><svg class="icon"><use href="#i-plus"/></svg><span data-i18n="new">Nueva</span></button>
            <button id="btnExitToLanding" class="btn btn-danger btn-top" data-i18n-title="exitToStart"><svg class="icon"><use href="#i-exit"/></svg><span data-i18n="exit">Salir</span></button>
          </div>
          <div class="hud-box hud-right">
            <span data-i18n="pointsLabel">Puntos</span>
            <strong id="scoreDisplay">0</strong>
          </div>
        </header>

        <article class="center-panel" aria-live="polite" aria-atomic="true">
          <p id="questionText" class="question-main" data-i18n="questionIdle">Pulsa iniciar para comenzar.</p>

          <section id="teacherPanel" class="teacher-panel hidden" aria-live="polite">
            <h3 data-i18n="teacherModeTitle">Modo docente</h3>
            <pre id="teacherStateText" class="teacher-state"></pre>
          </section>
        </article>

        <section class="game-middle">
          <aside class="side-panel side-left">
            <p class="control-title" data-i18n="gameControlTitle">Control de partida</p>
            <div class="left-controls-stack">
              <button id="btnReveal" class="btn btn-xl btn-tone-game" data-i18n="showAnswer">Ver respuesta</button>

              <div id="answerBlock" class="answer answer-side hidden">
                <strong data-i18n="answerLabel">Respuesta:</strong>
                <span id="answerText"></span>
              </div>

              <div class="actions-grid game-actions judge-controls">
                <button id="btnCorrect" class="btn btn-success hidden"><svg class="icon"><use href="#i-check"/></svg><span data-i18n="correct">Acertada</span></button>
                <button id="btnWrong" class="btn btn-danger hidden"><svg class="icon"><use href="#i-x"/></svg><span data-i18n="wrong">Fallada</span></button>
              </div>

              <div class="active-letter-zone" aria-live="polite" aria-atomic="true">
                <p class="active-letter-label" data-i18n="activeLetterLabel">Letra en juego</p>
                <strong id="activeLetter" class="active-letter-big">-</strong>
              </div>

              <button id="btnPass" class="btn btn-warn btn-xl left-pass-btn" data-i18n="pass">PASA</button>
            </div>
          </aside>

          <div class="rosco-stage">
            <div class="rosco-shell">
              <ul id="rosco" class="rosco" aria-label="Rosco de letras"></ul>
            </div>
          </div>

          <aside class="side-panel side-right">
            <p class="control-title" data-i18n="audioControlsTitle">Audio de pregunta y respuesta</p>
            <div class="actions-grid game-actions secondary-controls">
              <button id="btnReadQuestion" class="btn btn-tone-audio"><svg class="icon"><use href="#i-sound"/></svg><span data-i18n="repeatQuestion">Repetir pregunta</span></button>
              <button id="btnReadAnswer" class="btn btn-tone-audio hidden"><svg class="icon"><use href="#i-sound"/></svg><span data-i18n="readAnswer">Leer respuesta</span></button>
            </div>
            <div class="actions-grid game-actions audio-controls">
              <button id="btnTtsStop" class="btn btn-tone-audio btn-icon-only" data-i18n-aria-label="stopAudio" data-i18n-title="stopAudio"><svg class="icon"><use href="#i-stop"/></svg></button>
              <button id="btnTtsPause" class="btn btn-tone-audio btn-icon-only" data-i18n-aria-label="pauseAudio" data-i18n-title="pauseAudio"><svg class="icon"><use href="#i-pause"/></svg></button>
              <button id="btnTtsResume" class="btn btn-tone-audio btn-icon-only" data-i18n-aria-label="resumeAudio" data-i18n-title="resumeAudio"><svg class="icon"><use href="#i-play"/></svg></button>
            </div>
          </aside>
        </section>
      </div>
    </section>
  </main>

  <div id="summaryOverlay" class="overlay hidden" role="dialog" aria-modal="true" aria-label="Resumen final">
    <div class="overlay-card">
      <h2 id="summaryTitle">RESUMEN PARTIDA</h2>
      <p id="summaryReason" class="summary-reason">Finalizada</p>

      <div class="summary-dashboard">
        <article class="summary-stat">
          <span class="summary-label" data-i18n="summaryPlayerLabel">Jugador/equipo</span>
          <strong id="summaryPlayerName">-</strong>
        </article>
        <article class="summary-stat">
          <span class="summary-label" data-i18n="summaryScoreLabel">Puntuacion</span>
          <strong id="summaryScore">0</strong>
        </article>
        <article class="summary-stat">
          <span class="summary-label" data-i18n="summaryPercentLabel">Porcentaje</span>
          <strong id="summaryPercent">0%</strong>
        </article>
        <article class="summary-stat">
          <span class="summary-label" data-i18n="summaryCorrectLabel">Correctas</span>
          <strong id="summaryCorrect">0</strong>
        </article>
        <article class="summary-stat">
          <span class="summary-label" data-i18n="summaryWrongLabel">Falladas</span>
          <strong id="summaryWrong">0</strong>
        </article>
        <article class="summary-stat">
          <span class="summary-label" data-i18n="summaryPassedLabel">Pasadas</span>
          <strong id="summaryPassed">0</strong>
        </article>
        <article class="summary-stat">
          <span class="summary-label" data-i18n="summaryTimeLeftLabel">Tiempo restante</span>
          <strong id="summaryTimeLeft">00:00</strong>
        </article>
        <article class="summary-stat">
          <span class="summary-label" data-i18n="summaryTimeUsedLabel">Tiempo consumido</span>
          <strong id="summaryTimeUsed">00:00</strong>
        </article>
      </div>

      <div class="actions-grid">
        <button id="btnExportResults" class="btn" data-i18n="exportResults">Exportar resultados</button>
        <button id="btnOverlayNewGame" class="btn btn-primary" data-i18n="newGame">Nueva partida</button>
        <button id="btnOverlayExit" class="btn" data-i18n="exitToStart">Salir a inicio</button>
      </div>
    </div>
  </div>

  <div id="topScoresOverlay" class="overlay hidden" role="dialog" aria-modal="true" aria-label="Top 10">
    <div class="overlay-card">
      <h2 data-i18n="top10Title">Top 10 puntuaciones</h2>
      <ol id="topScoresList"></ol>
      <p id="topScoresEmpty" class="hint" data-i18n="top10Empty">Aún no hay puntuaciones guardadas.</p>
      <div class="actions-grid">
        <button id="btnCloseTopScores" class="btn" data-i18n="close">Cerrar</button>
      </div>
    </div>
  </div>

  <script type="module" src="js/app.js"></script>
</body>
</html>
